<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - FoodBot</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
            background: linear-gradient(135deg, #1e1e1e 0%, #2d2d2d 100%);
            color: #fff;
            min-height: 100vh;
        }
        
        .header {
            background: rgba(0,0,0,0.3);
            padding: 20px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 3px solid #dc2626;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .header h1 {
            font-size: 2.5em;
            font-weight: 700;
        }
        
        .header-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .header-actions a {
            padding: 10px 20px;
            border-radius: 8px;
            background: rgba(255,255,255,0.1);
            color: #fff;
            border: 1px solid rgba(255,255,255,0.2);
            text-decoration: none;
            font-weight: 600;
            transition: all 0.2s;
        }
        
        .header-actions a:hover {
            transform: translateY(-2px);
            background: rgba(255,255,255,0.15);
        }
        
        .btn {
            padding: 10px 20px;
            border-radius: 8px;
            border: none;
            font-size: 0.95em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            text-decoration: none;
            display: inline-block;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #dc2626 0%, #991b1b 100%);
            color: #fff;
        }
        
        .btn-secondary {
            background: rgba(255,255,255,0.1);
            color: #fff;
            border: 1px solid rgba(255,255,255,0.2);
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(220,38,38,0.3);
        }
        
        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 30px;
        }
        
        .grid { display: grid; gap: 25px; margin-bottom: 30px; }
        .grid-2 { grid-template-columns: repeat(auto-fit, minmax(500px, 1fr)); }
        .grid-3 { grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); }
        
        .card {
            background: rgba(255,255,255,0.05);
            border: 2px solid rgba(220,38,38,0.3);
            border-radius: 16px;
            padding: 25px;
            backdrop-filter: blur(10px);
        }
        
        .card-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid rgba(220,38,38,0.3);
        }
        
        .card-icon {
            font-size: 2em;
        }
        
        .card h2 {
            font-size: 1.6em;
            color: #dc2626;
        }
        
        .form-group {
            margin-bottom: 18px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #94a3b8;
            font-size: 0.95em;
        }
        
        input[type="text"], input[type="time"], input[type="number"], textarea, select {
            width: 100%;
            padding: 12px;
            background: rgba(255,255,255,0.05);
            border: 2px solid rgba(255,255,255,0.1);
            border-radius: 8px;
            color: #fff;
            font-size: 1em;
            font-family: inherit;
        }
        
        input:focus, textarea:focus, select:focus {
            outline: none;
            border-color: #dc2626;
        }
        
        input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }
        
        .checkbox-label {
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            margin-bottom: 15px;
        }
        
        .info-box {
            background: rgba(220,38,38,0.1);
            border: 2px solid rgba(220,38,38,0.3);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .info-box strong {
            color: #dc2626;
            display: block;
            margin-bottom: 12px;
            font-size: 1.1em;
        }
        
        .menu-inputs {
            display: none;
        }
        
        .menu-inputs.active {
            display: block;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }
        
        th {
            background: rgba(220,38,38,0.2);
            padding: 12px;
            text-align: left;
            font-weight: 600;
            border-bottom: 2px solid #dc2626;
        }
        
        td {
            padding: 12px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        
        tr:hover {
            background: rgba(255,255,255,0.02);
        }
        
        .badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 6px;
            font-size: 0.85em;
            font-weight: 600;
        }
        
        .badge-success {
            background: rgba(16,185,129,0.2);
            color: #10b981;
        }
        
        .message {
            background: rgba(16,185,129,0.2);
            border: 2px solid #10b981;
            color: #fff;
            padding: 15px 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        
        @media (max-width: 1200px) {
            .grid-2, .grid-3 { grid-template-columns: 1fr; }
        }
        
        @media (max-width: 768px) {
            .header h1 { font-size: 2em; }
            .header-actions { width: 100%; }
            .btn { width: 100%; text-align: center; }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üîß Admin</h1>
        <div class="header-actions">
            <a href="/admin/weekly">üìÖ Wochenplanung</a>
            <a href="/stats">üìä Statistiken</a>
            <a href="/history">üìú Historie</a>
            <a href="/kitchen">üç≥ K√ºche</a>
            <a href="/">üì° Touch</a>
            <a href="/logout">üö™ Logout</a>
        </div>
    </div>
    
    <div class="container">
        {% if message %}
        <div class="message">{{ message }}</div>
        {% endif %}
        
        <div class="grid grid-2">
            <!-- Men√º Card -->
            <div class="card">
                <div class="card-header">
                    <span class="card-icon">üçΩÔ∏è</span>
                    <h2>Men√º f√ºr heute</h2>
                </div>
                
                <form method="post">
                    <div class="checkbox-label">
                        <input type="checkbox" id="zwei_menues" name="zwei_menues_aktiv" value="1" 
                               {% if menu and menu.zwei_menues_aktiv %}checked{% endif %}
                               onchange="toggleMenuInputs(this.checked)">
                        <label for="zwei_menues" style="margin: 0;">Zwei Men√ºs anbieten</label>
                    </div>
                    
                    <div class="info-box">
                        <strong>‚è∞ Anmeldefrist</strong>
                        <div style="display: flex; gap: 15px; flex-wrap: wrap; align-items: center;">
                            <div class="checkbox-label" style="margin: 0;">
                                <input type="checkbox" name="deadline_enabled" value="1" 
                                       {% if not menu or menu.deadline_enabled %}checked{% endif %}>
                                <span>Frist aktiv</span>
                            </div>
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <span>Bis:</span>
                                <input type="time" name="registration_deadline" 
                                       value="{{ menu.registration_deadline if menu else '19:45' }}" 
                                       style="width: 120px; padding: 8px;">
                                <span>Uhr</span>
                            </div>
                        </div>
                    </div>
                    
                    <div id="single-menu" class="menu-inputs {% if not menu or not menu.zwei_menues_aktiv %}active{% endif %}">
                        <div class="form-group">
                            <label>Men√º</label>
                            <input type="text" list="menu-options" name="menu_text" 
                                   value="{{ menu.description if menu and not menu.zwei_menues_aktiv else '' }}" 
                                   placeholder="z.B. Schnitzel mit Pommes">
                        </div>
                    </div>
                    
                    <div id="dual-menu" class="menu-inputs {% if menu and menu.zwei_menues_aktiv %}active{% endif %}">
                        <div class="form-group">
                            <label>Men√º 1</label>
                            <input type="text" list="menu-options" name="menu1_text" 
                                   value="{{ menu.menu1_name if menu else '' }}" 
                                   placeholder="Erstes Men√º">
                        </div>
                        <div class="form-group">
                            <label>Men√º 2</label>
                            <input type="text" list="menu-options" name="menu2_text" 
                                   value="{{ menu.menu2_name if menu else '' }}" 
                                   placeholder="Zweites Men√º">
                        </div>
                    </div>
                    
                    <datalist id="menu-options">
                        {% for preset in preset_menus %}
                        <option value="{{ preset.name }}">
                        {% endfor %}
                    </datalist>
                    
                    <button type="submit" name="save_menu" value="1" class="btn btn-primary" style="width: 100%;">
                        ‚úÖ Men√º speichern
                    </button>
                </form>
            </div>
            
            <!-- G√§ste Card -->
            <div class="card">
                <div class="card-header">
                    <span class="card-icon">üë•</span>
                    <h2>G√§ste</h2>
                </div>
                
                <form method="post">
                    <div class="form-group">
                        <label>Anzahl G√§ste</label>
                        <input type="number" name="guest_count" value="{{ guest_count }}" min="0" max="50">
                    </div>
                    <button type="submit" name="guest_action" value="set" class="btn btn-primary" style="width: 100%;">
                        Speichern
                    </button>
                </form>
            </div>
        </div>
        
        <!-- Angemeldete Personen -->
        <div class="card">
            <div class="card-header">
                <span class="card-icon">üìã</span>
                <h2>Angemeldete Personen ({{ users|length }})</h2>
            </div>
            
            <table>
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Status</th>
                        <th>Aktion</th>
                    </tr>
                </thead>
                <tbody>
                    {% for user in users %}
                    <tr>
                        <td>{{ user.name }}</td>
                        <td>
                            {% if user.id in registered_ids %}
                            <span class="badge badge-success">‚úì Angemeldet</span>
                            {% endif %}
                        </td>
                        <td>
                            <form method="post" style="display: inline;">
                                <input type="hidden" name="user_id" value="{{ user.id }}">
                                <button type="submit" class="btn {% if user.id in registered_ids %}btn-secondary{% else %}btn-primary{% endif %}" 
                                        style="padding: 6px 15px; font-size: 0.9em;">
                                    {{ 'Abmelden' if user.id in registered_ids else 'Anmelden' }}
                                </button>
                            </form>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        
        <!-- Neuen User anlegen -->
        <div class="card">
            <div class="card-header">
                <span class="card-icon">‚ûï</span>
                <h2>User-Verwaltung</h2>
            </div>
            
            <h3 style="margin-bottom: 15px; font-size: 1.3em;">Neuen User anlegen</h3>
            <form method="post">
                <div class="grid grid-3">
                    <div class="form-group">
                        <label>Name</label>
                        <input type="text" name="new_name" placeholder="Max Mustermann" required>
                    </div>
                    <div class="form-group">
                        <label>Personalnummer</label>
                        <input type="text" name="new_personal_number" placeholder="12345" required>
                    </div>
                    <div class="form-group">
                        <label>Karten-ID (optional)</label>
                        <input type="text" name="new_card_id" placeholder="RFID Karte">
                    </div>
                </div>
                <button type="submit" class="btn btn-primary">User anlegen</button>
            </form>
            
            <h3 style="margin: 30px 0 15px; font-size: 1.3em;">CSV-Import</h3>
            <form method="post" enctype="multipart/form-data">
                <div class="form-group">
                    <label>CSV-Datei hochladen</label>
                    <input type="file" name="csv_file" accept=".csv" required 
                           style="padding: 10px; background: rgba(255,255,255,0.05); border: 2px dashed rgba(255,255,255,0.2);">
                </div>
                <button type="submit" class="btn btn-primary">CSV importieren</button>
            </form>
        </div>
        
        <!-- Preset-Men√ºs -->
        <div class="card">
            <div class="card-header">
                <span class="card-icon">üìù</span>
                <h2>Vordefinierte Men√ºs</h2>
            </div>
            
            <form method="post" style="margin-bottom: 20px;">
                <div style="display: flex; gap: 15px;">
                    <input type="text" name="new_preset_menu" placeholder="Neues Men√º hinzuf√ºgen" 
                           style="flex: 1;" required>
                    <button type="submit" name="add_preset_menu" value="1" class="btn btn-primary">
                        Hinzuf√ºgen
                    </button>
                </div>
            </form>
            
            <div style="display: flex; flex-wrap: wrap; gap: 10px;">
                {% for preset in preset_menus %}
                <div style="background: rgba(220,38,38,0.15); border: 1px solid rgba(220,38,38,0.3); 
                            border-radius: 8px; padding: 10px 15px; display: flex; align-items: center; gap: 10px;">
                    <span>{{ preset.name }}</span>
                    <form method="post" style="display: inline;">
                        <input type="hidden" name="delete_preset_id" value="{{ preset.id }}">
                        <button type="submit" name="delete_preset_menu" value="1" 
                                style="background: none; border: none; color: #ef4444; cursor: pointer; 
                                       font-size: 1.2em; padding: 0; line-height: 1;">
                            ‚úï
                        </button>
                    </form>
                </div>
                {% endfor %}
            </div>
        </div>
        
        <!-- User bearbeiten & l√∂schen -->
        <div class="card">
            <div class="card-header">
                <span class="card-icon">‚úèÔ∏è</span>
                <h2>Alle User</h2>
            </div>
            
            <table>
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Personalnummer</th>
                        <th>Karten-ID</th>
                        <th>QR-Code</th>
                        <th>Aktionen</th>
                    </tr>
                </thead>
                <tbody>
                    {% for user in users %}
                    <tr>
                        <td>{{ user.name }}</td>
                        <td>{{ user.personal_number }}</td>
                        <td>{{ user.card_id or '-' }}</td>
                        <td>
                            <a href="/qr/{{ user.id }}" target="_blank" class="btn btn-secondary" 
                               style="padding: 6px 12px; font-size: 0.85em;">
                                üì± QR
                            </a>
                        </td>
                        <td>
                            <button onclick="editUser({{ user.id }}, '{{ user.name }}', '{{ user.personal_number }}', '{{ user.card_id or '' }}')" 
                                    class="btn btn-secondary" style="padding: 6px 12px; font-size: 0.85em; margin-right: 5px;">
                                ‚úèÔ∏è
                            </button>
                            <form method="post" style="display: inline;">
                                <input type="hidden" name="delete_user" value="{{ user.id }}">
                                <button type="submit" class="btn btn-secondary" 
                                        onclick="return confirm('User {{ user.name }} wirklich l√∂schen?')"
                                        style="padding: 6px 12px; font-size: 0.85em; background: rgba(239,68,68,0.2);">
                                    üóëÔ∏è
                                </button>
                            </form>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    
    <!-- Edit User Modal -->
    <div id="editModal" style="display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.9); 
                                z-index: 1000; align-items: center; justify-content: center;">
        <div style="background: #1a1a1a; border: 3px solid #dc2626; border-radius: 20px; 
                    padding: 40px; max-width: 600px; width: 90%;">
            <h2 style="margin-bottom: 25px; color: #dc2626;">User bearbeiten</h2>
            <form method="post">
                <input type="hidden" id="edit_user_id" name="edit_user">
                <div class="form-group">
                    <label>Name</label>
                    <input type="text" id="edit_name" name="edit_name" required>
                </div>
                <div class="form-group">
                    <label>Personalnummer</label>
                    <input type="text" id="edit_personal_number" name="edit_personal_number" required>
                </div>
                <div class="form-group">
                    <label>Karten-ID</label>
                    <input type="text" id="edit_card_id" name="edit_card_id">
                </div>
                <div style="display: flex; gap: 15px; margin-top: 25px;">
                    <button type="submit" class="btn btn-primary" style="flex: 1;">Speichern</button>
                    <button type="button" onclick="closeEditModal()" class="btn btn-secondary" style="flex: 1;">
                        Abbrechen
                    </button>
                </div>
            </form>
        </div>
    </div>
    
    <script>
        function toggleMenuInputs(isDual) {
            document.getElementById('single-menu').classList.toggle('active', !isDual);
            document.getElementById('dual-menu').classList.toggle('active', isDual);
        }
        
        function editUser(id, name, personalNumber, cardId) {
            document.getElementById('edit_user_id').value = id;
            document.getElementById('edit_name').value = name;
            document.getElementById('edit_personal_number').value = personalNumber;
            document.getElementById('edit_card_id').value = cardId;
            document.getElementById('editModal').style.display = 'flex';
        }
        
        function closeEditModal() {
            document.getElementById('editModal').style.display = 'none';
        }
    </script>
</body>
</html>
